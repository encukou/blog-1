---
title: "You should remove half of your documentation"
date: 2023-10-13
tags:
  - misc
---

"Always write documentation for everything" seems like advice that you can give anyone in any situation and it will make everything better. It's not. There is a cost and risk associated with every line of documentation you write, and this is exactly what this blog post is about.

When I say "documentation", I mean all forms of it, including README, Markdown files, docstrings, and code comments.

## Why your documentation sucks

1. **It requires maintenance**. Each time a function behavior is changed or an argument is added or removed, the function documentation needs to be checked and updated. And not only the documentation of this function but potentially any other documentation that references it. And often the refactoring tools won't help you with that. Many IDEs for many languages will let you to rename a function and all references to it but won't change its name in documentation strings that reference it. And no IDE will help you if that reference is in a readme file or another plain text document.
1. **It gets outdated**. Naturally, when you change a function behavior but forget to update the documentation, they start to contradict each other. And no documentation is always better than documentation that lies. If function docs don't cover behavior in some corner-cases, I can check it myself. If it covers such behavior but that's not how it actually works, I will learn about it only when I get a nasty bug during tests or even on the prod.
1. **It can get noisy**. It takes time to read documentation, and if it doesn't bring anything in addition to the code (i.e. says the same as the line of code it describes or the function name), that time is spent without purpose. For example, I often see a comment like `# create a user` followed by a line of code like `user.create()`. Or a function `create_user` with documentation saying `"create_user creates a new user"`. You shouldn't make other people read the same thing twice.
1. **Nobody reads it anyway**. Everyone is in a hurry. There are hundreds of libraries in the project, constant pressure from the management to deliver features, and just lazyness. From this blog post, most people will read only the title, some will also look at section titles and the bold text in each bullet point, and only a few (you're probably one of them) will actually read all the text.

## What you should do

1. **Don't require documentation**. If you have a tool that enforces presence of documentation but doesn't check its quality, you will naturally get people writing documentation like "create_user creates a user". However, it's still a good idea to require documentation for public functions in an open-source library.
1. **Use type annotations**. If you can describe something in a way that it can be checked by a tool, you should do that. In particular, that means describing what are function argument and return types not in plain English but in a structured manner that can be checked by a type checker. Use [mypy](https://mypy.readthedocs.io/en/stable/) for Python, [TypeScript](https://www.typescriptlang.org/) for JS (with [JSDoc](https://www.typescriptlang.org/docs/handbook/intro-to-js-ts.html) or [the custom TypeScript syntax](https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes.html)), [Sorbet](https://sorbet.org/) for Ruby, etc.
1. **Provide examples and test them**. "Show, don't tell". Instead of explaining how the function behaves in some specific situation, make an example. And the great thing about code examples is that they can be tested. Use [doctest](https://docs.python.org/3/library/doctest.html) for Python, [doc-tests](https://doc.rust-lang.org/book/ch14-02-publishing-to-crates-io.html#documentation-comments-as-tests) for Rust, [testable examples](https://go.dev/blog/examples) for Go, etc.
1. **Write contracts**. Don't assume that users will call your function only with specific arguments. Check in the runtime that it is actually true. For example, if a function argument is expected to be only positive, add a check for it and return an error if this contract is violated. If your language has a good framework for [design by contract](https://en.wikipedia.org/wiki/Design_by_contract), use it. For example, [deal](https://github.com/life4/deal) for Python or [arguard](https://github.com/orsinium-labs/arguard) for Go.
1. **Write safe code**. "The best API is the one that canno be misused". Don't tell users that `Connection.close` must be called only after `Connection.open`. Instead, make `Connection.open` return a new `OpenConnection` object and make the `close` method to be available only on `OpenConnection` but not on `Connection`. That way, it's impossible to call `close` without calling `open` first.
1. **Avoid useless comments**.
1. **Prefer descriptive code**. If a code block is so confusing that it needs an explanation, instead of simply adding that explanation think if you can make the code itself more readable.
1. **Avoid duplication**. Don't say the same thing in many places. Instead, describe it once and reference it in all other places. That way, when you need to change it, you can do it once. For example, the first version of documentation for [genesis/channels](https://pkg.go.dev/github.com/life4/genesis@v1.10.0/channels) used to describe behavior for buffered channels and cancellation of each function in the function's documentation. While it's maybe more convenient for the users, it's a lot of duplication because almost all of the functions behave in the same way in this regard. So, the updated documentation describes it once, in the package documentation.
1. **Generate documentation**. For example, it's a common practice to generate OpenAPI specification from the code. The code already knows about available endpoints, supported HTTP methods, and expected types, so at least some parts of the public API documentation can be generated, saving lots of effort and avoiding situations when documentation gets out of sync.
1. **Write tests for documentation**. Sometimes, you'll have the same thing repeated twice, in the documentation and in the code. Maybe because you don't want to bother with generating documentation or maybe because you want to provide the best documentation-first experience for users. Either way, it might be a good idea to write tests for your documentation. For example, if you have a number of CLI commands defined in a project and each one should be described in the docs, you can parse the code, extract the list of defined commands, and test that indeed each one is mentioned in the docs.
1. **Keep documentation close to what it describes**. When modifying a piece of code, it's easier to notice documentation that needs to be updated if it is placed right next to the code it describes. For example, if you write a linter with a number of rules it checks, it might be a good idea to describe each rule in the code next to where it is defined instead of a separate file or documentation.
1. **Take some time to improve documentation readability**. Write TL;DR, structure the docs that it's easy to navigate, make improtant things bold, add emojis and visual clues, use lists and tables.
